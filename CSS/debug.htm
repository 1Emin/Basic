<div id="fooBar" style="float:left; width:20%;height:80%;overflow:scroll;">Variable list:<hr></div>
<DIV style="float:left; width:35%;">
<button id="run" onclick="cmdClick(this)">Run</button>
<button id="stop" onclick="cmdClick(this)">Stop</button>
<button id="pause" onclick="cmdClick(this)">Pause</button>
<button id="continue" onclick="cmdClick(this)">Continue</button>
<input type="text" id="connection_status" value="Disconnected">
<button id="clear" onclick="logClear()">Clear</button>
<textarea rows="20" style="width:100%" id="log">log</textarea>
<br>
</DIV>
<div style="float:left; width:45%;">
<iframe src="/input" width="100%" height="80%"></iframe>
</div>


<script>
start('ws://' + location.hostname + ':81/');

function start(websocketServerLocation)
{
    connection = new WebSocket(websocketServerLocation);
    connection.onopen = function()
    {
        //connection.send('websocket connected!'); 
        document.getElementById("connection_status").value = "Connected";
    };
    connection.onclose = function()
    {
        //try to reconnect in 5 seconds
        document.getElementById("connection_status").value = "Disconnected";
        setTimeout(function()
        {
            start(websocketServerLocation)
        }, 5000);
    };
    connection.onmessage = function(e)
    {
        connection.send('DEBUG'); 
        //alert(e);
        var res = e.data.split("~^`");
        if (res[0].toLowerCase() == "var")
        {
            var obj = document.getElementById(res[1]);
            document.getElementsByName(res[1])[0].value = res[2];
            connection.send("OK");
            return;
        }
        if (res[0].toLowerCase() == "varname")
        {
            var obj = document.getElementById(res[1]);
            document.getElementsByName("var" + res[1].toString())[0].value = res[2];
            connection.send("OK");
            return;
        }
        else if (res[0].toLowerCase() == "log")
        {
            connection.send('OK');
            var log = document.getElementById("log");
            log.value = res[1] + "\n" + log.value;
            log.selectionStart = log.selectionEnd = log.value.length;
            return;
        }
        else
        {
            // default 
            connection.send("DEBUG");
        }
    };
};


makeVarList()
connection.onerror = function(error)
{

    document.getElementById("connection_status").value = error;
};

function cmdClick(e)
{
    connection.send("cmd:" + e.id);
}

function logClear()
{
    document.getElementById("log").value = "";
}

function objEvent(e)
{
    connection.send("guievent:" + e.name + ":" + document.getElementById(e.id).value);
}

function objChange(e)
{
    connection.send("guichange~" + e.name + "~" + document.getElementById(e.id).value);
}



function makeVarList()
{
    for (xxx = 0; xxx < 51; xxx++)
    {
        add(xxx.toString(), "");
    }
}

//Create text boxes for variables
function add(itemName, itemValue)
{
    var foo = document.getElementById("fooBar");

    var element = document.createElement("input");
    element.setAttribute("type", "text");
    element.setAttribute("value", itemValue);
    element.setAttribute("name", "var" + itemName);
    element.setAttribute("style", "width:50%");

    var element1 = document.createElement("input");
    element1.setAttribute("type", "text");
    element1.setAttribute("value", itemValue);
    element1.setAttribute("name", itemName);
    element1.setAttribute("style", "width:50%");


    foo.appendChild(element);
    foo.appendChild(element1);
}
</script>